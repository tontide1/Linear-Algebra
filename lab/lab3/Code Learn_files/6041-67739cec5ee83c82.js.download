(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6041],{25831:function(e,t,n){"use strict";var i=n(26042),a=n(69396),r=n(99534),o=n(85893),l=n(67887),s=n.n(l),c=n(15660),d=n.n(c),u=(n(26764),n(79016),n(39980),n(52503),n(80366),n(27046),n(4279),n(2731),n(24335),n(15251),n(67294)),m=n(27856),v=n.n(m),h=n(96486),f=n(82859),p=n(97274),g=n(90512);t.Z=function(e){var t=e.className,n=void 0===t?"":t,l=e.line,c=e.content,m=e.children,b=(0,r.Z)(e,["className","line","content","children"]);v().addHook("afterSanitizeAttributes",(function(e){if("target"in e){e.setAttribute("target","_blank"),e.setAttribute("rel","noopener");var t=e.getAttribute("href");t&&!t.startsWith("http")&&(t=p.uz+t,e.setAttribute("href",t))}if("src"in e){var n=e.getAttribute("src");!n||n.startsWith("http")||n.startsWith("data")||(n=p.L4+n,e.setAttribute("src",n))}}));var x=v().sanitize(c||m);return(0,u.useEffect)((function(){d().highlightAll()}),[x]),(0,h.isNil)(l)?(0,o.jsx)("div",(0,a.Z)((0,i.Z)({},b),{className:(0,g.Z)(n,s().root),dangerouslySetInnerHTML:{__html:x}})):(0,o.jsx)(f.Q,{line:l,children:(0,o.jsx)("div",(0,a.Z)((0,i.Z)({},b),{className:(0,g.Z)(n,s().root),dangerouslySetInnerHTML:{__html:x}}))})}},42018:function(e,t,n){"use strict";var i=n(26042),a=n(29815),r=n(9473),o=n(89486),l=n(67294),s=n(33721),c=n(96906),d=n(44138),u=n(44104),m=n(23769),v=n(77063),h=n(42121),f=n(1798),p=n.n(f),g=n(29433),b=n(96486),x=n(79290),_=n(25228),j=n(97892);t.Z=function(){var e=(0,g.$G)().t,t=(0,r.I0)();(0,_.RT)({onConnected:function(){}});var n=(0,o.Z)(),f=(0,r.v9)(v.Ns),w=(0,h.z)(),N=w.refetch,E=w.manualUpdateChatList,y=(0,s.r)().markSeenNotifyChat,C=(0,c.N)().clearHistories,S=(0,d.S)().leaveRoom,A=(0,r.oR)(),I=(0,l.useCallback)((function(){setTimeout((function(){var e,t;if((null===(e=A.getState())||void 0===e||null===(t=e.chat)||void 0===t?void 0:t.width)>768){var i,a,r=null===(i=A.getState())||void 0===i||null===(a=i.chat)||void 0===a?void 0:a.chatWindows,o=r.filter((function(e){return!e.isMinimize})).length,l=r.filter((function(e){return e.isMinimize})).length,s=20.5*o*16;s<=0&&l>0?s=120:l>0&&(s+=66),n.postMessage(j.J["EDV.API.ChatWindows.setWidth"],s+"px")}}),200)}),[]),T=(0,l.useCallback)((function(e){var n,r,o=(0,b.cloneDeep)(e),l=null===(n=A.getState())||void 0===n||null===(r=n.chat)||void 0===r?void 0:r.chatWindows,s=null===l||void 0===l?void 0:l.find((function(e){return e.id===o.id}));if(s){s=(0,i.Z)({},s,e);var c=l.findIndex((function(e){return e.id==o.id}));if(c===l.length-1&&!s.isMinimize)return;s.isMinimize=!1;var d=(0,a.Z)(l);d.splice(c,1),d.push(s),t((0,v.Pd)(d))}else o.isMinimize=!1,o.lastActiveTime=(new Date).valueOf(),t((0,v.Pd)((0,a.Z)(l).concat([o])));setTimeout((function(){var e,n,i=null===(e=A.getState())||void 0===e||null===(n=e.chat)||void 0===n?void 0:n.width;if(i>768){var a,r,o=null===(a=A.getState())||void 0===a||null===(r=a.chat)||void 0===r?void 0:r.chatWindows;if(!(20.5*o.filter((function(e){return!e.isMinimize})).length*16>i-66-0))return;var l=(0,b.cloneDeep)(o),s=l.filter((function(e){return!e.isMinimize})),c=s.some((function(e,t){if(!x.Z.hasContentIsTyping(e.id)&&t<s.length-1)return e.isMinimize=!0,!0}));c||s.some((function(e,t){if(t<s.length-1)return e.isMinimize=!0,!0})),t((0,v.Pd)(l))}}),100),I()}),[I]);return(0,l.useEffect)((function(){var e=p().subscribe(u.qz.OPEN_CHAT_FROM_PARENT,(function(e,t){T(t)})),i=p().subscribe(u.qz.OPEN_CHAT,(function(e,i){var a,r,o=i.data;(null===(a=A.getState())||void 0===a||null===(r=a.chat)||void 0===r?void 0:r.width)>768&&(n.postMessage(j.J["EDV.API.Chat.close"]),t((0,v.MN)(!1)),t((0,v.nV)(!1))),T(o)}));return function(){p().unsubscribe(e),p().unsubscribe(i)}}),[T,A]),(0,l.useEffect)((function(){var e=p().subscribe(u.qz.CLOSE_CHAT_WINDOW,(function(e,n){var i,a,r=n.id,o=null===(i=A.getState())||void 0===i||null===(a=i.chat)||void 0===a?void 0:a.chatWindows;t((0,v.Pd)(o.filter((function(e){return e.id!==r})))),I()})),n=p().subscribe(u.qz.MINIMIZE_CHAT_WINDOW,(function(e,n){var i,a,r=n.id,o=null===(i=A.getState())||void 0===i||null===(a=i.chat)||void 0===a?void 0:a.chatWindows;t((0,v.Pd)((0,b.cloneDeep)(o).map((function(e){return e&&(null===e||void 0===e?void 0:e.id)==r&&(e.isMinimize=!0),e})))),I()}));return function(){p().unsubscribe(e),p().unsubscribe(n)}}),[I,A]),(0,l.useEffect)((function(){f&&N()}),[f]),(0,l.useEffect)((function(){var i=p().subscribe(u.qz.CLOSE_ALL_CHAT_WINDOW,(function(){t((0,v.Pd)([]))})),a=p().subscribe(u.qz.ON_NEW_NOTIFY,(function(){N()})),r=p().subscribe(u.qz.UPDATE_CHAT_ROOM_LIST_WHEN_USER_ADD,(function(){N()})),o=p().subscribe(u.qz.ON_FRESH_DATA,(function(){N()})),l=p().subscribe(u.qz.MANUAL_UPDATE_CHAT_LIST,(function(e,t){E(t)})),s=p().subscribe(u.qz.OPEN_CHAT,(function(e,t){var i=t.data;n.postMessage(j.J["EDV.API.ChatWindows.set"],i)})),c=p().subscribe(u.qz.ACTION_MENU_IN_SIDEBAR,(function(t,n){var i=n.id;switch(n.action){case u.kl.LEAVE:(0,m.gH)({message:e("Are you sure to leave this conversation? You will not send or receive messages anymore."),onConfirm:function(){S(i)}});break;case u.kl.CLEAR_CHAT:C(i),y(i)}}));return function(){p().unsubscribe(r),p().unsubscribe(a),p().unsubscribe(o),p().unsubscribe(i),p().unsubscribe(c),p().unsubscribe(l),p().unsubscribe(s)}}),[]),null}},98074:function(e,t,n){"use strict";n.d(t,{Lu:function(){return Ie}});var i=n(47568),a=n(29815),r=n(70655),o=n(85893),l=n(44104),s=n(23880),c=n(25228),d=n(96906),u=n(67294),m=n(44138),v=n(8357),h=n(23769),f=n(55856),p=n(1798),g=n.n(p),b=n(29433),x=n(26042),_=n(10753),j=n(30642),w=n.n(j),N=n(31716),E=n(90512),y=function(e){var t=e.action,n=e.id,i=e.inChatBox,a=void 0!==i&&i;return(0,o.jsx)("li",(0,x.Z)({className:"chat-option hover:bg-[#EEEFFA] hover:text-[#2C31CF] text-[#3B3C54] transition-all cursor-pointer px-2 py-1 rounded",onClick:function(){return function(e,t){a?g().publish(l.qz.ACTION_MENU,{id:e,action:t}):g().publish(l.qz.ACTION_MENU_IN_SIDEBAR,{id:e,action:t})}(n,t)}},e))},C=function(e){var t=(0,x.Z)({},e),n=t.id,i=t.type,a=void 0===i?"private":i,r=t.isOwner,s=void 0!==r&&r,c=t.mute,d=void 0===c?"":c,m=t.isActive,v=void 0===m||m,h=t.inChatBox,p=void 0===h||h,j=(t.isLast,t.isRefreshItem),C=t.visible,S=void 0===C||C,A=(0,u.useState)(!1),I=A[0],T=A[1],M=(0,u.useState)(d);M[0],M[1];(0,u.useEffect)((function(){j&&T(!1);var e=g().subscribe(l.qz.IS_CLOSE_MENU,(function(e,t){var i=t.id;n==i&&T(!1)}));return function(){g().unsubscribe(e)}}),[n,v,j,d]);var D=(0,_.O)((function(){return T(!1)})),O=(0,b.$G)().t,R=function(){var e=(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(y,{inChatBox:p,id:n,action:l.kl.EDIT_ROOMNAME,children:O("Change group name")}),(0,o.jsx)(y,{inChatBox:p,id:n,caction:l.kl.SHOW_MEMBERS,children:O("List members")}),(0,o.jsx)(y,{inChatBox:p,id:n,action:l.kl.ADD_MEMBERS,children:O("Add member")}),(0,o.jsx)(y,{inChatBox:p,id:n,action:l.kl.REMOVE_MEMBER,children:O("Remove member")})]});return(0,o.jsx)(o.Fragment,{children:s?e:"contextgroup"!=a.toLocaleLowerCase()?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(y,{inChatBox:p,id:n,action:l.kl.EDIT_ROOMNAME,children:O("Change group name")}),(0,o.jsx)(y,{inChatBox:p,id:n,action:l.kl.SHOW_MEMBERS,children:O("List members")}),(0,o.jsx)(y,{inChatBox:p,id:n,action:l.kl.ADD_MEMBERS,children:O("Add member")})]}):(0,o.jsx)(y,{inChatBox:p,id:n,action:l.kl.SHOW_MEMBERS,children:O("List members")})})};return S?(0,o.jsxs)(o.Fragment,{children:[function(){if(v)return(0,o.jsx)("span",{className:(0,E.Z)("rounded-full hover:bg-[#EEEFFA] transition-colors w-8 h-8 inline-flex cursor-pointer items-center justify-center",{"bg-gray-200":I}),onClick:function(){T(!I)},children:(0,o.jsx)(f.Z,{name:"dots-menu"})})}(),I&&(0,o.jsxs)("ul",{ref:D,className:(0,E.Z)("list-chat-options absolute top-11 right-1 t-full rounded bg-white z-10 p-1 text-sm",w()["sub-menu"]),children:[p&&(0,o.jsx)(o.Fragment,{children:"private"!==a&&R()}),a&&"contextgroup"!=a.toLocaleLowerCase()&&"private"!=a.toLocaleLowerCase()&&(0,o.jsx)(y,{inChatBox:p,id:n,action:l.kl.LEAVE,children:O("Leave")}),(0,o.jsx)(y,{inChatBox:p,id:n,action:l.kl.CLEAR_CHAT,children:(0,o.jsxs)("div",{className:"flex items-center gap-3 font-bold p-1",children:[(0,o.jsx)(N.HG,{width:20,height:20}),O("Delete chat")]})})]})]}):(0,o.jsx)(o.Fragment,{})},S=n(80061),A=function(e){var t=e.onCloseChangeGroupName,n=e.roomId,i=e.onChangeGroupName,a=(0,b.$G)().t,r=(0,u.useState)(!1),l=r[0],s=r[1],c="";null!=document.querySelector("#group-chat-name-".concat(n))&&(c=document.querySelector("#group-chat-name-".concat(n)).textContent);var d=(0,u.useState)(c),m=d[0],v=d[1];return(0,o.jsx)("div",{className:"absolute w-full h-full bg-black z-10 shadow-lg p-2 px-3",children:(0,o.jsxs)("div",{className:"bg-white rounded-md p-4",children:[(0,o.jsx)("p",{className:"font-bold m-0 mb-4",children:a("Change group name")}),(0,o.jsxs)("div",{className:"flex items-center gap-2 justify-between",children:[(0,o.jsx)(S.o,{defaultValue:c+"",onChange:function(e){return t=e.currentTarget.value,v(t.trim()),void(0==t.trim().length?s(!0):s(!1));var t}}),(0,o.jsx)("span",{onClick:function(){return t()},className:"bg-gray-lighter flex items-center justify-center h-10 w-10 rounded-md cursor-pointer",children:(0,o.jsx)(f.Z,{size:18,name:"close"})}),(0,o.jsx)("span",{className:"h-10 w-10 ".concat(l?"cursor-not-allowed":""),children:(0,o.jsx)("span",{onClick:function(){return i(m)},className:"bg-blue-primary text-white flex items-center justify-center h-10 w-10 rounded-md cursor-pointer ".concat(l?"cursor-not-allowed opacity-40 pointer-events-none":""),children:(0,o.jsx)(f.Z,{size:18,name:"done"})})})]})]})})},I=n(30381),T=n.n(I),M=n(84644),D=n(69396),O=n(79290),R=function(e){var t=e.files;return(0,o.jsx)("div",{className:"flex flex-col gap-2",children:t&&t.length>0&&t.map((function(e){M.DL.isJsonString(e)&&(e=JSON.parse(e));var t=!!e.name&&null!=e.name.match(".pdf");return(0,o.jsxs)("div",{className:"message-file ".concat(e.type,"-attachment flex py-2"),"data-content":"'".concat(JSON.stringify(e),"'"),children:["image"==e.type?(0,o.jsx)("a",{className:"block w-[200px] max-w-[200px]",href:e.url,target:"_blank",rel:"noreferrer",children:(0,o.jsx)("img",{className:"max-h-[400px] max-w-[200px] overflow-hidden object-contain",src:e.url,alt:e.name})}):(0,o.jsx)(o.Fragment,{}),"video"==e.type?(0,o.jsx)("video",{className:"max-h-[400px] max-w-[200px] max-w-full overflow-hidden",controls:!0,children:(0,o.jsx)("source",{src:e.url,type:"video/mp4"})}):(0,o.jsx)(o.Fragment,{}),"file"==e.type?(0,o.jsxs)("a",{className:"flex gap-2 hover:text-blue-pressed text-inherit",href:e.url,target:t?"_blank":"_self",download:!0,rel:"noreferrer",children:[(0,o.jsx)("span",{className:"text-gray flex items-start",children:(0,o.jsx)(f.Z,{size:40,name:"description"})}),(0,o.jsx)("div",{style:{wordBreak:"break-word"},className:"text-inherit text-sm overflow-hidden text-left",children:e.name})]}):(0,o.jsx)(o.Fragment,{})]},e.url)}))})},k=n(48929),L=n(9473),z=function(e){var t=(0,b.$G)().t,n=e.data,a=e.allowEdit,l=e.roomId,s=e.isPrivate,d=e.handleEdit,u=(0,L.v9)(k.tM),m=function(){var e=(0,i.Z)((function(e,t){return(0,r.__generator)(this,(function(n){return(0,c.bG)(e,t),[2]}))}));return function(t,n){return e.apply(this,arguments)}}(),v=function(){var e=O.Z.MessageData(null===n||void 0===n?void 0:n.id,"DELETE_MESSAGE",null,null,null,s,null===u||void 0===u?void 0:u.id);m(l,e).then((function(){}))};return(0,o.jsxs)("div",{className:w()["submenu-wrap"],children:[(0,o.jsx)(f.Z,{name:"dots-menu"}),(0,o.jsxs)("div",{className:w()["submenu-content"],children:[a?(0,o.jsx)("div",{onClick:function(){return function(){d&&d();var e=document.getElementById("chat-upload-btn-".concat(l));null!=e&&e.classList.add("btn-disabled")}()},title:t("Edit"),children:t("Edit")}):(0,o.jsx)(o.Fragment,{}),(0,o.jsx)("div",{onClick:function(){(0,h.gH)({message:t("Are you sure delete this message"),onConfirm:function(){v()},overlayProps:{opacity:0}})},title:t("Delete"),children:t("Delete")})]})]})},Z=function(e){var t=(0,L.v9)(k.tM),n=(0,b.$G)().t,i=e.message,a=e.fileHtml,r=e.roomId,s=e.isPrivate,c=e.handleEdit;return(0,o.jsxs)("div",{className:"".concat(w()["message-item-menu"]," ").concat((null===i||void 0===i?void 0:i.senderId)==(null===t||void 0===t?void 0:t.id)?w()["current-user"]:""),children:[(0,o.jsx)("div",{onClick:function(){g().publish(l.qz.REPLY_ACTION,{data:i,roomId:r})},title:n("Reply"),children:(0,o.jsx)(f.Z,{name:"reply"})}),(null===i||void 0===i?void 0:i.senderId)==(null===t||void 0===t?void 0:t.id)?(0,o.jsx)(z,{handleEdit:c,isPrivate:s,roomId:r,data:i,allowEdit:a}):(0,o.jsx)(o.Fragment,{})]})},F=n(52615),H=n(67841),P=n(87536),W=n(25831),q=function(e){var t=e.isActive,n=e.isCurrentUser,a=e.roomId,l=e.isPrivate,s=e.data,d=(0,L.v9)(k.tM),m=(0,u.useState)(!1),v=m[0],h=m[1],p=(0,u.useState)(!1),g=p[0],_=p[1],j=(0,b.$G)().t,E=(0,P.cI)({defaultValues:{content:""}}),y=E.register,C=E.handleSubmit,S=(E.control,E.setValue),A=(E.watch,E.reset,E.getValues,E.formState.errors,function(){var e=(0,i.Z)((function(e,t){return(0,r.__generator)(this,(function(n){return(0,c.bG)(e,t),[2]}))}));return function(t,n){return e.apply(this,arguments)}}()),I=function(e){var t;if((null===e||void 0===e||null===(t=e.content)||void 0===t?void 0:t.length)>0){var n=null===e||void 0===e?void 0:e.content,i=null,r=document.getElementById("message-content-reply-".concat(s.id));null==r||r.classList.contains("hidden")||(i=JSON.parse(r.getAttribute("data-reply-object")));var o=O.Z.MessageData(s.id,"EDIT_MESSAGE",n,"",i,l,null===d||void 0===d?void 0:d.id);A(a,o).then((function(){h(!1)}));var c=document.getElementById("chat-upload-btn-".concat(a));null!=c&&c.classList.contains("btn-disabled")&&c.classList.remove("btn-disabled")}},T=function(e){return(0,o.jsxs)("form",{noValidate:!0,onSubmit:C(I),className:"".concat(v?"isEditting-message-".concat(a):"hidden"," w-full p-2 bg-blue-light rounded-md"),children:[(0,o.jsx)(F.g,(0,D.Z)((0,x.Z)({},y("content")),{onChange:function(e){return function(e){var t;(null===(t=e.trim())||void 0===t?void 0:t.length)>0?_(!1):_(!0)}(e.currentTarget.value)},onKeyDown:function(t){return function(e,t){if(13==e.keyCode){if(e.shiftKey)return;var n=document.getElementById("button-reply-".concat(t));null!=n&&(n.focus(),n.click(),e.currentTarget.focus(),e.preventDefault())}}(t,e)},placeholder:j("Aa"),classNames:{root:"flex-grow mb-2"},id:"txt-reply-".concat(e)})),(0,o.jsxs)("div",{className:"flex items-center justify-end",children:[(0,o.jsx)(H.z,{onClick:function(){return function(){h(!1);var e=document.getElementById("chat-upload-btn-".concat(a));null!=e&&e.classList.contains("btn-disabled")&&e.classList.remove("btn-disabled")}()},variant:"outline",size:"xs",className:"h-10",children:(0,o.jsx)(f.Z,{name:"close"})}),(0,o.jsx)(H.z,{id:"button-reply-".concat(e),disabled:g,type:"submit",size:"xs",className:"ml-2 h-10",children:(0,o.jsx)(f.Z,{name:"done"})})]})]})};return(0,o.jsx)(o.Fragment,{children:function(){var e,i,r;if("LOADING"===s.type)return(0,o.jsx)("div",{className:"message max-w-full "+(n?"text-right":"text-left"),id:"message-".concat(s.id),"data-id":s.id,"data-time-stamp":s.timestamp,children:(0,o.jsx)("div",{className:"".concat(w()["wrap-detail-message"]," relative inline-block"),children:(0,o.jsx)("div",{className:"message-content rounded-md border border-[#CCCCCC] px-3 py-1 h-[34px] flex items-center ".concat(n?"bg-[#EEEFFF]":"bg-white"," "),style:{backgroundColor:s.deleted?"#C9C9C9":""},children:(0,o.jsx)(N.iU,{color:"#999",height:20,width:40})})})});var c=void 0!==s.data?null===s||void 0===s||null===(e=s.data)||void 0===e?void 0:e.text:"",d=void 0!==s.data?null===s||void 0===s||null===(i=s.data)||void 0===i?void 0:i.url:"",u=void 0!==s.data?null===s||void 0===s||null===(r=s.data)||void 0===r?void 0:r.replyObject:"",m="",p="message",g="";s.deleted?(c=j("This message is deleted."),p+=" message-removed",g+=" bg-gray-light text-sm italic"):"undefined"!=typeof d&&(null===d||void 0===d?void 0:d.length)>0&&(m=(0,o.jsx)(R,{files:d}));var b="";void 0===s.updatedTime||s.deleted||(p+=" message-edited",b=j("Edited"));var x="";if(u){var _={};(function(e){try{JSON.parse(e)}catch(t){return!1}return!0})(u)&&(_=JSON.parse(u));var E;E=(0,o.jsx)("h4",{title:_.userName,className:"".concat(w()["reply-author"]," m-0 fs-12 truncate"),children:_.userName});var y="",C=_.url,A=O.Z.decodeQuote(_.text);if((null===C||void 0===C?void 0:C.length)>0){var I=M.DL.isJsonString(C[0])?JSON.parse(C[0]):C[0],D="file"==I.type,k=!!I.name&&null!=I.name.match(".pdf");y=(0,o.jsx)("p",{className:"reply-file mg-b-3 font-italic text-blue",children:(0,o.jsxs)("a",{href:I.url,target:!D||k?"_blank":"",rel:"noreferrer",download:D,children:["image"==I.type?(0,o.jsxs)("span",{className:"flex items-center gap-1",children:[(0,o.jsx)(f.Z,{name:"image",size:16})," ",j("Image")]}):(0,o.jsx)(o.Fragment,{}),"video"==I.type?(0,o.jsxs)("span",{className:"flex items-center gap-1",children:[(0,o.jsx)(f.Z,{name:"play-video",size:16})," ",j("Video")]}):(0,o.jsx)(o.Fragment,{}),"file"==I.type?(0,o.jsxs)("span",{className:"flex items-center gap-1",children:[(0,o.jsx)(f.Z,{name:"attachment",size:16})," ",j("Attachment file")]}):(0,o.jsx)(o.Fragment,{})]})})}x=(0,o.jsxs)("div",{id:"message-content-reply-".concat(s.id),className:"".concat(w()["content-reply"]," fs-14 text-left"),"data-reply-for":_.id,"data-reply-object":"".concat(O.Z.encodeSingleQuote(JSON.stringify(u))),children:[E,(0,o.jsxs)("div",{className:"wrap-content-reply",children:[y,(0,o.jsx)("div",{title:M.DL.escapeForTitleAttribute(M.DL.htmlDecode(A)),className:"message-text",style:{whiteSpace:"break-spaces",wordBreak:"break-word"},children:(0,o.jsx)(W.Z,{content:O.Z.Linkify(A)})})]})]})}return(0,o.jsxs)("div",{className:p+" max-w-full "+(n?"text-right":"text-left"),id:"message-".concat(s.id),"data-id":s.id,"data-time-stamp":s.timestamp,children:[x,T(s.id),(0,o.jsxs)("div",{className:"".concat(w()["wrap-detail-message"]," relative inline-block"),children:[(0,o.jsxs)("div",{className:"message-content rounded-md border border-[#CCCCCC] px-3 py-1 ".concat(n?"bg-[#EEEFFF]":"bg-white"," ").concat(g," ").concat(v?"hidden":""),style:{backgroundColor:s.deleted?"#C9C9C9":""},children:[m,(0,o.jsx)("div",{className:"".concat(w()["message-text"]," text-left"),"data-after":b,"data-content":M.DL.escapeForTitleAttribute(M.DL.htmlDecode(c)),style:{whiteSpace:"break-spaces",wordBreak:"break-word"},children:(0,o.jsx)(W.Z,{content:O.Z.Linkify(c)})})]}),!s.deleted&&t?(0,o.jsx)(Z,{handleEdit:function(){return function(e){var t;h(!0),S("content",M.DL.htmlDecode(null===s||void 0===s||null===(t=s.data)||void 0===t?void 0:t.text)),setTimeout((function(){var t,n=document.getElementById("txt-reply-".concat(e));null!=n&&(n.value=M.DL.htmlDecode(null===s||void 0===s||null===(t=s.data)||void 0===t?void 0:t.text),n.focus())}),200)}(s.id)},isPrivate:l,roomId:a,message:s,fileHtml:""==m}):(0,o.jsx)(o.Fragment,{})]})]})}()})},U=n(55444),G=n(97274),B=function(e){var t=e.data,n=e.isActive,i=e.roomId,a=e.isPrivate,r=e.isGroupMessage,l=void 0===r||r,s=e.hasAvatar,c=void 0!==s&&s,d=e.showAvatarOnly,u=void 0!==d&&d,m=(0,b.$G)().t,v=(0,L.v9)(k.tM),h=t.senderId===G.qY;return(0,o.jsx)(o.Fragment,{children:function(){if(t.id){var e="message-container mb-1 flex gap-1 inline-block message-of-"+(null===t||void 0===t?void 0:t.senderId),r=!1,s="",d="";try{var f,p;if((null===t||void 0===t?void 0:t.senderId)==(null===v||void 0===v?void 0:v.id))r=!0,e+=" current-user justify-end";else e+=" justify-start",d=function(e){var t="",n="";try{return e.id==(null===v||void 0===v?void 0:v.id)?(t=m("You"),n=m("You")):(t=e.fullName?e.fullName:e.username,n=e.username?e.username:t),{name:t,account:n}}catch(i){return{name:t,account:n}}}(null===t||void 0===t?void 0:t.sender),s=h?(0,o.jsx)("img",{width:40,height:40,src:null===t||void 0===t||null===(f=t.sender)||void 0===f?void 0:f.avatarUrl,className:"mes-user-avatar flex-none h-7 w-7 rounded-full overflow-hidden border border-solid border-gray object-cover",alt:M.DL.escapeForTitleAttribute(d.account)}):(0,o.jsx)(U.Z,{href:"/profile/".concat(t.senderId),target:"_blank",children:(0,o.jsx)("img",{width:40,height:40,src:null===t||void 0===t||null===(p=t.sender)||void 0===p?void 0:p.avatarUrl,className:"mes-user-avatar flex-none h-7 w-7 rounded-full overflow-hidden border border-solid border-gray object-cover",alt:M.DL.escapeForTitleAttribute(d.account)})}),d=h?(0,o.jsx)("h4",{className:"mes-user-name text-xs font-bold m-0 mb-1",title:M.DL.escapeForTitleAttribute(d.account),"data-user-name":M.DL.escapeForTitleAttribute(d.name),"data-user-id":null===t||void 0===t?void 0:t.senderId,children:M.DL.htmlEncode(d.name)}):(0,o.jsx)(U.Z,{href:"/profile/".concat(t.senderId),target:"_blank",children:(0,o.jsx)("h4",{className:"mes-user-name text-xs font-bold m-0 mb-1",title:M.DL.escapeForTitleAttribute(d.account),"data-user-name":M.DL.escapeForTitleAttribute(d.name),"data-user-id":null===t||void 0===t?void 0:t.senderId,children:M.DL.htmlEncode(d.name)})})}catch(g){s="",d=""}return(0,o.jsxs)("div",{className:e,"data-time-stamp":null===t||void 0===t?void 0:t.timestamp,style:{maxWidth:r?"calc(100% - 68px)":"calc(100% - 36px)"},children:[l||c||u?s:(0,o.jsx)(o.Fragment,{}),(0,o.jsxs)("div",{className:"wrap-main-message flex flex-col items-start",children:[l||c||u?d:(0,o.jsx)(o.Fragment,{}),(0,o.jsx)("div",{className:"wrap-content-message w-full flex flex-col items-start ".concat(l||c||u?"":"pl-8"),children:(0,o.jsx)(q,{isPrivate:a,roomId:i,isCurrentUser:r,data:t,isActive:n})})]})]})}return""}()})},Y=n(62097),V=n.n(Y),$=function(e,t){var n=(0,L.v9)(k.tM),i=(0,b.$G)().t,a=function(e){var t="",a="";try{return e.id==n.id?(t=i("You"),a=i("You")):(t=e.fullName?e.fullName:e.username,a=e.username?e.username:t),{name:t,account:a}}catch(r){return{name:t,account:a}}},r="message-container message-notice",l=a(e.sender),s=l.name?l.name:l.account,c=(0,o.jsx)("span",{className:"".concat(V()["mes-user-name"]," font-bold"),title:"".concat(l.name," (").concat(l.account,")"),children:s}),d=void 0===e.data?"DELETE":e.data.type,u=void 0===e.data?null:e.data.message,m=e.timestamp;switch(d){case"USERS_ADDED":if(r+=" user-added",u.members.length>1)t=(0,o.jsxs)(o.Fragment,{children:[i("added")," ",(0,o.jsxs)("span",{className:"".concat(V()["mes-user-name"]," font-bold"),title:u.members.length+" "+i("members"),children:[" ",u.members.length," ",i("members")," "]})," ",i("to group")]});else{var v=u.members[0];v=a(v),t=(0,o.jsxs)(o.Fragment,{children:[i("added")," ",(0,o.jsxs)("span",{className:"".concat(V()["mes-user-name"]," font-bold"),title:"".concat(v.name," (").concat(v.account,")"),children:[" ",v.name," "]})," ",i("to group")]})}break;case"USERS_REMOVED":if(r+=" user-removed",u.members.length>1)t=(0,o.jsxs)(o.Fragment,{children:[i("removed")," ",(0,o.jsxs)("span",{className:"".concat(V()["mes-user-name"]," font-bold"),children:[" ",u.members.length," ",i("members")," "]})," ",i("from the group")]});else{var h=u.members[0];h=a(h),t=(0,o.jsxs)(o.Fragment,{children:[i("removed")," ",(0,o.jsxs)("span",{className:"".concat(V()["mes-user-name"]," font-bold"),title:"".concat(h.name," (").concat(h.account,")"),children:[" ",h.name," "]})," ",i("from the group")]})}break;case"USERS_LEFT_ROOM":if(r+=" user-left-room",t=i("left the group"),null!=u&&null!=u.newOwner){var f=a(u.newOwner),p=u.newOwner.id==n.id?i("ARE_NEW_OWNER"):i("IS_NEW_OWNER"),g=u.newOwner.id==n.id?f.name:f.name+" ("+f.account+")";t=(0,o.jsxs)(o.Fragment,{children:[i("left the group"),"."," ",(0,o.jsx)("span",{className:"".concat(V()["mes-user-name"]," font-bold"),title:g,children:f.name})," ",p]})}break;case"ROOM_NAME_UPDATED":r+=" room-updated",t=(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("span",{children:[i("named the group")," "]}),(0,o.jsx)("span",{className:"".concat(V()["mes-user-name"]," font-bold"),title:null===u||void 0===u?void 0:u.newName,children:null===u||void 0===u?void 0:u.newName})]});break;default:m=""}return(0,o.jsx)("div",{className:"".concat(r," text-center flex justify-center"),"data-time-stamp":m,children:(0,o.jsxs)("div",{className:"message-notice-content flex items-center justify-center gap-1 flex-wrap text-xs my-2 bg-gray-300 ".concat(""==t?" hidden":""),style:{padding:"5px 10px",borderRadius:"25px"},children:[c," ",t]})})},J=function(e){var t=e.data,n=(0,b.$G)().t;return(0,o.jsx)(o.Fragment,{children:function(){var e;switch(void 0===t.data?"DELETE":null===t||void 0===t||null===(e=t.data)||void 0===e?void 0:e.type){case"PRIVATE_CHAT_STARTED":return $(t,"");case"ROOM_CREATED":return $(t,n(" created the group"));default:return $(t,void 0)}}()})},K=function(e){var t=e.data;return e.isGroupMessage?(0,o.jsxs)("div",{className:"text-xs text-center mt-2 mb-2 min-w-full",children:[new Date(t.timestamp).toLocaleString(),(0,o.jsx)("br",{})]}):(0,o.jsx)(o.Fragment,{})},Q=function(e){var t=e.data,n=e.isLast,i=e.isActive,a=e.roomId,r=e.isPrivate,s=e.isEnableScroll,c=void 0===s||s,d=e.isGroupMessage,m=void 0===d||d,v=e.hasAvatar,h=void 0!==v&&v,f=e.showAvatarOnly,p=void 0!==f&&f,g=(0,L.v9)(k.tM),b=(null===t||void 0===t?void 0:t.senderId)==(null===g||void 0===g?void 0:g.id);(0,u.useEffect)((function(){var e=document.querySelector(".last-message-".concat(a));c&&null!=e&&e.scrollIntoView()}),[c]);return(0,o.jsx)("div",{id:"message-item-".concat(null===t||void 0===t?void 0:t.id),className:"message-wrap-item flex-wrap ".concat(b&&(null===t||void 0===t?void 0:t.type)!=l.YN.SYSTEM_MESSAGE?"flex justify-end":""," ").concat(n?"last-message-".concat(a):""),children:(null===t||void 0===t?void 0:t.type)==l.YN.SYSTEM_MESSAGE?(0,o.jsx)(J,{isActive:i,data:t}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(K,{data:t,isGroupMessage:m}),(0,o.jsx)(B,{showAvatarOnly:p,hasAvatar:h,isGroupMessage:m,isPrivate:r,roomId:a,isActive:i,data:t})]})})},X=n(96486),ee=function(e){var t=e.isActive,n=void 0===t||t,a=e.roomId,s=e.messages,c=e.isPrivate,d=e.loadMoreHistory,m=e.isEnableScroll,v=(0,u.useRef)(null),h=(0,u.useRef)(!1),f=(0,u.useRef)(d),p=(0,L.v9)(k.tM);G.qY>p.id?"".concat(p.id,"_").concat(G.qY):"".concat(G.qY,"_").concat(p.id);(0,u.useEffect)((function(){f.current=d}));var g=(0,u.useRef)((0,X.throttle)((0,i.Z)((function(){var e,t,n,i,a;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return!v.current||h.current?[3,2]:(e=v.current,t=e.scrollTop,n=e.scrollHeight,t<(i=1/n*2e5)&&f.current?(window.debugScrollChat&&console.log(t,i),h.current=!0,[4,null===(a=f.current)||void 0===a?void 0:a.call(f)]):[3,2]);case 1:r.sent(),h.current=!1,r.label=2;case 2:return[2]}}))})),300)),b=null,x=0,_=l.YN.SYSTEM_MESSAGE;return(0,o.jsx)("div",{id:"detail-chat-".concat(a),onScroll:function(){return g.current()},ref:v,className:"bg-[#F6F6F6] detail-chat flex-grow overflow-y-auto overflow-x-hidden p-2 pt-6",children:s&&s.length>0&&s.sort((function(e,t){return e.timestamp<t.timestamp?-1:1})).map((function(e,t){var i,r=!0,d=!0,u=!0;null!==b&&(r=T()(new Date(null===e||void 0===e?void 0:e.timestamp)).diff(new Date(b),"milliseconds")>12e5,d=_==l.YN.SYSTEM_MESSAGE,_=e.type);return"MESSAGE"===(null===e||void 0===e||null===(i=e.data)||void 0===i?void 0:i.type)&&(b=null===e||void 0===e?void 0:e.timestamp),0==x||(u=(null===e||void 0===e?void 0:e.senderId)!=x),x=null===e||void 0===e?void 0:e.senderId,(0,o.jsx)(Q,{isLast:t==s.length-1,isPrivate:c,roomId:a,isActive:n,data:e,isEnableScroll:m,showAvatarOnly:d,isGroupMessage:r,hasAvatar:u},e.id)}))})},te=n(49734),ne=n(77506),ie=function(e){var t=e.listFile,n=e.onRemoveFile,i=e.roomId;return(0,o.jsx)("div",{className:"display-file-upload-section px-1 py-1 ".concat(t&&0==t.length?"hidden":""),children:(0,o.jsx)("ul",{id:"list-file-upload-".concat(i),className:"flex flex-nowrap gap-1 pt-1 overflow-x-auto",style:{minHeight:"82px"},children:t&&t.length>0&&t.map((function(e,t){return function(e,t){return"video"==(null===e||void 0===e?void 0:e.type)?(0,o.jsxs)("li",{title:null===e||void 0===e?void 0:e.name,className:"h-14 w-14 relative",children:[(0,o.jsx)("span",{onClick:function(){return n(t)},className:"absolute z-10 -top-1 -right-1 cursor-pointer rounded-full bg-red-500 inline-flex items-center justify-center text-white",children:(0,o.jsx)(f.Z,{name:"close",size:18})}),(0,o.jsx)("div",{className:"text-gray flex items-center justify-left",children:(0,o.jsx)("video",{style:{height:"45px",width:"46px",objectFit:"cover"},src:null===e||void 0===e?void 0:e.url})}),(0,o.jsx)("p",{className:"text-xs text-ink-primary overflow-hidden overflow-ellipsis whitespace-nowrap",children:null===e||void 0===e?void 0:e.name})]},null===e||void 0===e?void 0:e.url):"image"==(null===e||void 0===e?void 0:e.type)?(0,o.jsxs)("li",{title:null===e||void 0===e?void 0:e.name,className:"h-14 w-14 relative",children:[(0,o.jsx)("span",{onClick:function(){return n(t)},className:"absolute z-10 -top-1 -right-1 cursor-pointer rounded-full bg-red-500 inline-flex items-center justify-center text-white",children:(0,o.jsx)(f.Z,{name:"close",size:18})}),(0,o.jsx)("div",{className:"text-gray flex items-center justify-left",children:(0,o.jsx)("img",{style:{height:"45px",width:"46px",objectFit:"cover"},src:null===e||void 0===e?void 0:e.url,alt:null===e||void 0===e?void 0:e.name})}),(0,o.jsx)("p",{className:"text-xs text-ink-primary overflow-hidden overflow-ellipsis whitespace-nowrap",children:null===e||void 0===e?void 0:e.name})]},null===e||void 0===e?void 0:e.url):(0,o.jsxs)("li",{title:null===e||void 0===e?void 0:e.name,className:"h-14 w-14 relative",children:[(0,o.jsx)("span",{onClick:function(){return n(t)},className:"absolute z-10 -top-1 -right-1 cursor-pointer rounded-full bg-red-500 inline-flex items-center justify-center text-white",children:(0,o.jsx)(f.Z,{name:"close",size:18})}),(0,o.jsx)("div",{className:"text-gray flex items-center justify-left",children:(0,o.jsx)(f.Z,{name:"description",size:45})}),(0,o.jsx)("p",{className:"text-xs text-ink-primary overflow-hidden overflow-ellipsis whitespace-nowrap",children:null===e||void 0===e?void 0:e.name})]},null===e||void 0===e?void 0:e.url)}(e,t)}))})})},ae=n(33076),re=n(33721),oe=n(36155),le=n(98150),se=n.n(le),ce=n(11163),de=n(27856),ue=n.n(de),me=n(89486),ve=n(97892),he="".concat("100"),fe=function(e){var t,n=e.roomId,d=e.isActive,m=void 0===d||d,h=e.data,p=e.onReconnect,x=(0,b.$G)().t,_="/messages"===(0,ce.useRouter)().pathname,j=(0,L.v9)(k.tM),w=(0,u.useState)([]),N=w[0],y=w[1],C=(0,u.useState)(!1),S=C[0],A=C[1],I=(0,u.useState)(!1),T=I[0],M=I[1],D=(0,re.r)().markSeenNotifyChat,R=(0,u.useState)(""),z=R[0],Z=R[1],P=(null===(t=h.friend)||void 0===t?void 0:t.id)===G.qY,W=(0,me.Z)();(0,u.useEffect)((function(){g().subscribe(l.qz.REPLY_ACTION,(function(e,t){var n=t.data,i=t.roomId;if((null===n||void 0===n?void 0:n.id)&&""!=(null===n||void 0===n?void 0:n.id)){var a=document.getElementById("txt-smg-".concat(i));null!=a&&a.focus()}}));var e=g().subscribe(l.qz.USER_ADD,(function(e,t){t.room_Id==n&&M(!0)}));return function(){g().unsubscribe(e)}}),[]),(0,u.useEffect)((function(){if(!P){var e=document.getElementById("chatbox-".concat(n));null!=e&&(e.addEventListener("dragover",(function(t){t.preventDefault(),t.stopPropagation(),e.style.border="2px dashed gray"})),e.addEventListener("dragleave",(function(t){t.preventDefault(),t.stopPropagation(),e.style.border="unset"})),e.addEventListener("drop",(function(t){t.preventDefault(),t.stopPropagation();var n=t.dataTransfer.files;Y(n),e.style.border="unset"})))}}),[]);var q=function(){var e=n,t=N;if(z.length&&z.replace(/\s/g,"").length||t.length>0){var i=null,a=document.getElementById("reply-area-".concat(n));null==a||a.classList.contains("hidden")||(i=a.getAttribute("data-reply-object"));var r=O.Z.MessageData(null,"TEXT",z,t,i,!0,null===j||void 0===j?void 0:j.id);null!=a&&a.classList.add("hidden"),Z(""),y([]),(0,c.bG)(e,r),U(),P&&(g().publish(l.qz.CHAT_GPT_LOADING,!0),s.a.chatPushMessage({userId:null===j||void 0===j?void 0:j.id,message:ue().sanitize(z,{ALLOWED_TAGS:["#text"]})}).then((function(e){var t;(null===e||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)&&W.postMessage(ve.J["EDV.API.Notify.error"],x(e.data.message))})).finally((function(){U(),g().publish(l.qz.CHAT_GPT_LOADING,!1)})))}},U=function(){setTimeout((function(){var e=document.getElementById("detail-chat-".concat(n));if(null!=e){var t=e.scrollTop;e.scrollHeight-e.clientHeight-t>20&&e.scrollTo(0,e.scrollHeight)}}),300)},B=(N.length>0||z.length>0)&&m,Y=function(){var e=(0,i.Z)((function(e){var t,i,o,l,s,d,u,m,v;return(0,r.__generator)(this,(function(h){switch(h.label){case 0:if((0,c.Qi)(n),null==e)return[3,9];if(!((t=Object.values(e)).length>0))return[3,9];if(!$(t,"upload"))return[2];A(!0),i=!0,o=!1,l=void 0,h.label=1;case 1:h.trys.push([1,6,7,8]),s=function(){var e,t,n,i,o,l,s,c;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:e=u.value,n=null===(t=e)||void 0===t?void 0:t.name,i=J(n),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,ae.C.upload(t,ne.r5.supportAttach)];case 2:return(null===(l=r.sent())||void 0===l||null===(o=l.data)||void 0===o?void 0:o.success)?y((function(e){var t,r;return(0,a.Z)(e).concat([{name:n,type:i,url:null===l||void 0===l||null===(t=l.data)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.url}])})):(null===l||void 0===l||null===(s=l.data)||void 0===s?void 0:s.message)&&te.gU.error(x(null===l||void 0===l||null===(c=l.data)||void 0===c?void 0:c.message)),[3,4];case 3:return r.sent(),[3,4];case 4:return[2]}}))},d=t[Symbol.iterator](),h.label=2;case 2:return(i=(u=d.next()).done)?[3,5]:[5,(0,r.__values)(s())];case 3:h.sent(),h.label=4;case 4:return i=!0,[3,2];case 5:return[3,8];case 6:return m=h.sent(),o=!0,l=m,[3,8];case 7:try{i||null==d.return||d.return()}finally{if(o)throw l}return[7];case 8:A(!1),null!=(v=document.getElementById("txt-smg-".concat(n)))&&v.focus(),h.label=9;case 9:return[2]}}))}));return function(t){return e.apply(this,arguments)}}(),V=function(e){var t=e.split("."),n=t[t.length-1].toLocaleLowerCase();return!["png","jpg","jpeg","gif","bmp"].includes(n)},$=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"upload",i=!0,a=[];if("paste"==t){var r=!0,o=!1,l=void 0;try{for(var s,c=e[Symbol.iterator]();!(r=(s=c.next()).done);r=!0){var d=s.value;if("file"==(null===d||void 0===d?void 0:d.kind)){var u=d.getAsFile();a.push(u)}}}catch(v){o=!0,l=v}finally{try{r||null==c.return||c.return()}finally{if(o)throw l}}}else"upload"==t&&(a=e);if(a.some((function(e){return(null===e||void 0===e?void 0:e.name.length)>100}))?(te.gU.error(x("The entire file name must not exceed 100 characters")),i=!1):a.some((function(e){return(null===e||void 0===e?void 0:e.size)>1024*parseInt(he)*1024}))?(te.gU.error(x("Upload file size must not exceed ")+he+"Mb"),i=!1):a.some((function(e){return V(null===e||void 0===e?void 0:e.name)}))&&(te.gU.error(x("Invalid uploaded file. The system supports files in .png,.jpg,.jpeg,.gif,.bmp")),i=!1),!i){var m=document.getElementById("edn-cb-mediaCapture-".concat(n));null!=m&&(m.value="")}return i},J=function(e){return/\.(ppt|pptx|doc|docx|xlsx|xls|pdf|rar|7z)$/i.test(e)?"file":/\.(mp4|mov|avi|wmv|m4v)$/i.test(e)?"video":/\.(jpe?g|png|gif|bmp)$/i.test(e)?"image":void 0},K=function(){(0,c.Qi)(n),D(h.id)},Q=function(){var e=(0,i.Z)((function(e){var t,i;return(0,r.__generator)(this,(function(r){return null!=e&&(t=[],i=function(){var n=!0,i=!1,r=void 0;try{for(var o,l=function(){var e=o.value;if("file"!=(null===e||void 0===e?void 0:e.kind))return"continue";A(!0);var n=e.getAsFile(),i=null===n||void 0===n?void 0:n.name,r=J(i),l=ae.C.upload(n,ne.r5.supportAttach).then((function(e){var t,n,o,l,s,c,d;(null===e||void 0===e||null===(t=e.data)||void 0===t?void 0:t.success)?(N.push({name:i,type:r,url:null===e||void 0===e||null===(n=e.data)||void 0===n||null===(o=n.data)||void 0===o?void 0:o.url}),y((0,a.Z)(N))):(null===e||void 0===e||null===(l=e.data)||void 0===l?void 0:l.message)&&null!=(null===e||void 0===e||null===(s=e.data)||void 0===s?void 0:s.message)&&""!=(null===e||void 0===e||null===(c=e.data)||void 0===c?void 0:c.message)&&te.gU.error(x(null===e||void 0===e||null===(d=e.data)||void 0===d?void 0:d.message));return e}));t.push(l)},s=e[Symbol.iterator]();!(n=(o=s.next()).done);n=!0)l()}catch(c){i=!0,r=c}finally{try{n||null==s.return||s.return()}finally{if(i)throw r}}},i(),Promise.all(t).then((function(e){A(!1);var t=document.getElementById("txt-smg-".concat(n));null!=t&&t.focus()}))),[2]}))}));return function(t){return e.apply(this,arguments)}}();return(0,o.jsx)(o.Fragment,{children:(0,o.jsx)("div",{className:(0,E.Z)("form-send bottom-0",se().formSendChat,{"cursor-not-allowed":!m,"!static":_}),children:(0,o.jsxs)("div",{className:"message-form relative rounded-sm",children:[!P&&(0,o.jsx)(ie,{roomId:n,onRemoveFile:function(e){var t=(0,a.Z)(N);t.splice(e,1),y(t)},listFile:N}),(0,o.jsxs)("div",{className:"flex gap-2 items-center",children:[!P&&(0,o.jsxs)("div",{className:"uploadFile flex items-center w-8",children:[(0,o.jsx)(v.zv,{visible:S,children:(0,o.jsx)("div",{className:"w-5 h-5",children:(0,o.jsx)(v.LD,{size:"20"})})}),(0,o.jsx)(v.zv,{visible:!S,children:(0,o.jsxs)("span",{id:"chat-upload-btn-".concat(n),className:"inline-flex items-center justify-center chat-btn min-w-8 w-6 h-8",children:[(0,o.jsx)("label",{htmlFor:"edn-cb-mediaCapture-".concat(n),className:"la la-paperclip flex items-center justify-center ".concat(m?"cursor-pointer":"opacity-40 cursor-not-allowed"),children:(0,o.jsx)(f.Z,{name:"paper-clip",className:"text-[#65656D]",size:20})}),(0,o.jsx)("input",{onChange:function(e){return Y(e.currentTarget.files)},id:"edn-cb-mediaCapture-".concat(n),name:"edn-cb-mediaCapture",className:"input-upload-file-chat hidden",type:"file",disabled:!m,accept:".png,.jpg,.jpeg,.gif,.bmp",multiple:!0})]})})]}),(0,o.jsx)("div",{className:"w-full relative",onClick:function(){return!m&&K()},children:(0,o.jsx)(F.g,{value:z,onChange:function(e){return Z(e.target.value)},onKeyDown:function(e){return function(e){if((0,c.Qi)(n),13==e.keyCode){if(e.shiftKey)return;e.preventDefault(),e.currentTarget.focus(),B&&q()}}(e)},onPaste:function(e){return function(e){if(!P){(0,c.Qi)(n);var t=(e.clipboardData||e.originalEvent.clipboardData).items;t.length<1||$(t,"paste")&&Q(t)}}(e)},onClick:function(){return K()},placeholder:x("Aa"),classNames:{root:"flex-grow w-full",input:"bg-gray-lighter border border-[#ccc] rounded-xl"},radius:"lg",autoFocus:!m,disabled:!m,autosize:!0,minRows:1,maxRows:4,id:"txt-smg-".concat(n)})}),(0,o.jsx)(H.z,{className:"submit !bg-transparent text-[#111] chat-btn w-7 p-0 h-10 inline-flex items-center justify-center",type:"submit",disabled:!B,title:x("Send"),onClick:function(){document.getElementById("txt-smg-".concat(n)).focus(),B&&q()},children:(0,o.jsx)(oe.Z,{height:24,width:24})})]}),T&&(0,o.jsx)("div",{onClick:function(){return M(!1),void(p&&p())},className:"absolute text-sm text-center p-1 w-full h-full font-semibold bg-gray-lighter cursor-pointer text-blue-primary",style:{height:"calc(100% + 8px)",width:"calc(100% + 8px)",top:"-4px",left:"-4px"},children:x("You are added to this group. Click here to reload the chat history.")})]})})})},pe=n(38623),ge=n(95714),be=function(e){var t=e.roomId,n=e.onCloseListMembers,i=e.isEnableRemoveMember,a=void 0!==i&&i,r=e.onRemoveMember,l=(0,u.useState)(!0),c=l[0],d=l[1],m=(0,b.$G)().t,h=(0,u.useState)({members:[],ownerId:0}),p=h[0],g=h[1];return(0,u.useEffect)((function(){!function(e){s.a.getMembersOfRoom(e).then((function(e){g(e.data),d(!1)})).catch((function(){g({members:[],ownerId:0}),d(!1)}))}(t)}),[t]),(0,o.jsxs)("div",{className:"absolute w-full h-full bg-white z-10 shadow-lg p-2 px-3 border-t-1",style:{top:"-1px"},children:[(0,o.jsx)("span",{onClick:function(){return n()},className:"cursor-pointer absolute right-2 top-1 h-8 w-8 rounded-full transition-all duration-300 inline-flex items-center justify-center hover:bg-critical-background ",children:(0,o.jsx)(f.Z,{size:20,name:"close"})}),!a&&(0,o.jsxs)("p",{className:"font-bold m-0 mb-4",children:[m("Member")," (",(null===p||void 0===p?void 0:p.members)&&(null===p||void 0===p?void 0:p.members.length)," ",(null===p||void 0===p?void 0:p.members)&&(null===p||void 0===p?void 0:p.members.length)>1?m("members"):m("member"),")"]}),a&&(0,o.jsx)("p",{className:"font-bold m-0 mb-4",children:m("Remove member")}),(0,o.jsxs)(v.zv,{visible:c,children:[(0,o.jsx)(pe.O,{className:"mb-2",height:36,width:"100%"}),(0,o.jsx)(pe.O,{className:"mb-2",height:36,width:"100%"}),(0,o.jsx)(pe.O,{className:"mb-2",height:36,width:"100%"}),(0,o.jsx)(pe.O,{className:"mb-2",height:36,width:"100%"}),(0,o.jsx)(pe.O,{className:"mb-2",height:36,width:"100%"})]}),(0,o.jsx)(v.zv,{visible:!c,children:(0,o.jsx)("ul",{className:"overflow-y-auto overflow-x-hidden",style:{maxHeight:"calc(100% - 42px)"},children:(null===p||void 0===p?void 0:p.members)&&(null===p||void 0===p?void 0:p.members.length)>0&&(null===p||void 0===p?void 0:p.members.map((function(e,t){var n=void 0!=(null===e||void 0===e?void 0:e.fullName)&&null!=(null===e||void 0===e?void 0:e.fullName)&&""!=(null===e||void 0===e?void 0:e.fullName)?null===e||void 0===e?void 0:e.fullName:null===e||void 0===e?void 0:e.username,i=void 0!=(null===e||void 0===e?void 0:e.fullName)&&null!=(null===e||void 0===e?void 0:e.fullName)&&""!=(null===e||void 0===e?void 0:e.fullName)?null===e||void 0===e?void 0:e.username:"",l=null===e||void 0===e?void 0:e.avatarUrl,s=!!l&&!l.endsWith("/user.png")?l:"";return(0,o.jsxs)("li",{className:"flex items-center gap-2 mb-3 ".concat(V()["member-item"]),children:[(0,o.jsx)(ge.ZP,{className:"min-w-[36px]",size:"36",round:!0,src:s,name:n}),(0,o.jsxs)("div",{style:{maxWidth:"calc(100% - 40px)"},className:"flex items-center justify-between flex-grow pr-1",children:[(0,o.jsxs)("strong",{style:{maxWidth:"calc(100% - 15px)"},className:"text-sm flex-grow flex flex-wrap items-center",children:[(0,o.jsx)("span",{title:n,style:{maxWidth:"calc(100% - 30px)"},className:"whitespace-nowrap overflow-hidden overflow-ellipsis",children:n}),(null===e||void 0===e?void 0:e.id)===(null===p||void 0===p?void 0:p.ownerId)?(0,o.jsx)("span",{className:"text-yellow-600",children:(0,o.jsx)(f.Z,{name:"star"})}):"",(0,o.jsx)("span",{title:i,className:"fullname font-normal text-xs whitespace-nowrap overflow-hidden overflow-ellipsis",style:{flex:"0 0 100%"},children:i})]}),a&&(null===e||void 0===e?void 0:e.id)!==(null===p||void 0===p?void 0:p.ownerId)&&(0,o.jsx)("div",{onClick:function(){return r(e.id,null===e||void 0===e?void 0:e.username)},title:m("Remove member"),className:"cursor-pointer hover:text-red-500 flex items-center ".concat(V()["btn-remove-member"]),children:(0,o.jsx)(f.Z,{size:18,name:"close"})})]})]},t)})))})})]})},xe=function(e){var t=e.roomId,n=(0,b.$G)().t,i=(0,L.v9)(k.tM),a=(0,u.useState)(!1),r=a[0],s=a[1],c=(0,u.useState)(""),d=c[0],m=c[1],v=(0,u.useState)(""),h=v[0],p=v[1],x=(0,u.useState)(""),_=x[0],j=x[1];return(0,u.useEffect)((function(){var t=g().subscribe(l.qz.REPLY_ACTION,(function(t,a){var r,o,l,c,d=a.data,u=a.roomId;if(e.roomId==u){s(!1);var v=(new Date).toString();j(v);var h=(null===d||void 0===d?void 0:d.senderId)==(null===i||void 0===i?void 0:i.id)?n("yourself"):null===d||void 0===d||null===(r=d.sender)||void 0===r?void 0:r.username,f=null===d||void 0===d||null===(o=d.data)||void 0===o?void 0:o.type,g=null===d||void 0===d||null===(l=d.data)||void 0===l?void 0:l.url,b=n("Attachment file");g.length>0&&(M.DL.isJsonString(g[0])?"image"==JSON.parse(g[0]).type?b=n("Image"):"video"==JSON.parse(g[0]).type?b=n("Video"):"file"==JSON.parse(g[0]).type&&(b=n("Attachment file")):"image"==g[0].type?b=n("Image"):"video"==g[0].type?b=n("Video"):"file"==g[0].type&&(b=n("Attachment file")));var x="ATTACHMENT"==f?b:null===d||void 0===d||null===(c=d.data)||void 0===c?void 0:c.text;if(""!=h){var _,w,N,E;s(!0),m(h),p(x);var y=null===d||void 0===d||null===(_=d.data)||void 0===_?void 0:_.url,C={id:null===d||void 0===d?void 0:d.id,text:M.DL.htmlDecode(null===d||void 0===d||null===(w=d.data)||void 0===w?void 0:w.text),url:y,type:y.length>0?"ATTACHMENT":"MESSAGE",userId:null===d||void 0===d||null===(N=d.sender)||void 0===N?void 0:N.id,userName:null===d||void 0===d||null===(E=d.sender)||void 0===E?void 0:E.username};setTimeout((function(){var e=document.getElementsByClassName("reply-message-".concat(v))[0];null!=e&&e.setAttribute("data-reply-object",O.Z.encodeSingleQuote(JSON.stringify(C)))}),100)}}}));return function(){g().unsubscribe(t)}}),[]),(0,o.jsxs)("div",{id:"reply-area-".concat(t),className:"border-t-slate-200 border-t px-3 py-1 text-sm pr-6 relative reply-message-".concat(_," ").concat(r?"":"hidden"),children:[(0,o.jsx)("span",{title:n("Remove"),className:"flex items-center justify-center cursor-pointer absolute top-1 right-1 hover:text-red",onClick:function(){return s(!1)},children:(0,o.jsx)(f.Z,{name:"close"})}),(0,o.jsxs)("div",{className:"whitespace-nowrap overflow-hidden overflow-ellipsis",children:[(0,o.jsxs)("span",{children:[n("Replying to")," "]}),(0,o.jsx)("strong",{title:d,children:d})]}),(0,o.jsx)("div",{className:"whitespace-nowrap overflow-hidden overflow-ellipsis text-gray-500",title:M.DL.escapeForTitleAttribute(M.DL.htmlDecode(h)),children:M.DL.htmlDecode(h)})]})},_e=n(6781),je=n(18686),we=n(90263),Ne=function(e){var t,n,i=e.open,a=e.onClose,r=e.dataRoom,l=e.onSubmit,s=(0,b.$G)().t,c=(0,u.useState)([]),d=c[0],m=c[1],v=d.length<=0;return(0,o.jsxs)(je.u,{centered:!0,opened:i,onClose:a,title:(0,o.jsx)("strong",{className:"text-xl",children:s("Add member")}),size:"lg",children:[(0,o.jsxs)("label",{className:"text-sm",children:[s("Friend")," ",(0,o.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,o.jsx)(we.Z,{excludeUsernames:null===(n=null===r||void 0===r||null===(t=r.members)||void 0===t?void 0:t.map((function(e){return e.username})))||void 0===n?void 0:n.filter((function(e){return!(0,X.isNil)(e)})),value:d,onChange:m}),(0,o.jsxs)("div",{className:"flex items-center mt-3 gap-2 justify-end",children:[(0,o.jsx)("span",{onClick:function(){return a()},className:"bg-gray-lighter flex items-center justify-center h-10 w-10 rounded-md cursor-pointer",style:{minWidth:"40px"},children:(0,o.jsx)(f.Z,{size:18,name:"close"})}),(0,o.jsx)("span",{onClick:function(){return l(d.map((function(e){return e.id})))},className:"bg-blue-secondary text-white flex items-center justify-center h-10 w-10 rounded-md cursor-pointer ".concat(v?"cursor-not-allowed opacity-40 pointer-events-none":""),style:{minWidth:"40px"},children:(0,o.jsx)(f.Z,{size:18,name:"done"})})]})]})},Ee=function(e){var t,n=e.data,p=e.isFullHeight,x=(0,b.$G)().t,_=(0,L.v9)(k.tM),j=(0,_e.t)().locale,w="/messages"===(0,_e.t)().pathname,N=G.qY>_.id?"".concat(_.id,"_").concat(G.qY):"".concat(G.qY,"_").concat(_.id),y=(0,c.EM)({roomId:n.id},j),S=y.messages,I=y.closeChanel,T=y.loadMoreMessage,M=y.reConnect,D=(0,d.N)((function(e){I()})).clearHistories,R=(0,u.useState)(!1),z=R[0],Z=R[1],F=(null===(t=n.friend)||void 0===t?void 0:t.id)===G.qY,P=z&&F?(0,a.Z)(S||[]).concat([{id:"1234",roomId:N,senderId:G.qY,timestamp:new Date,type:"LOADING",deleted:!1,privateChat:!0,replyMessageId:"",reactions:[],sender:{id:G.qY,username:"GPT",fullName:"GPT",avatarUrl:"https://codelearnstorage.s3.amazonaws.com/CodeCamp/CodeCamp/Upload/Avatar/bef5badd33ad48d2a718973757f2d7c4.jpeg",preventShowChat:!1}}]):S,W=function(){var e=(0,u.useState)([]),t=e[0],n=e[1];return{dataRoom:t,setFilterDataRoom:function(e){s.a.getMembersOfRoom(e).then((function(e){n(e.data)})).catch((function(){n([])}))}}}(),q=W.dataRoom,B=W.setFilterDataRoom,Y=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=function(){var t=(0,i.Z)((function(t,n){return(0,r.__generator)(this,(function(i){switch(i.label){case 0:return[4,s.a.addMembersToRoom(t,n).then((function(t){null!=e&&e()})).catch((function(){console.log("Add member to room failed")}))];case 1:return i.sent(),[2]}}))}));return function(e,n){return t.apply(this,arguments)}}();return{addMemberToRoom:t}}((function(){ve(!1)})).addMemberToRoom,$=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=function(){var t=(0,i.Z)((function(t,n){return(0,r.__generator)(this,(function(i){switch(i.label){case 0:return[4,s.a.removeMemberFromRoom(t,[n]).then((function(t){t&&null!=e&&e()})).catch((function(){console.log("Remove member failed")}))];case 1:return i.sent(),[2]}}))}));return function(e,n){return t.apply(this,arguments)}}();return{removeMember:t}}((function(){le(!1),je(!1)})).removeMember,J=(0,m.S)((function(e){I(),g().publish(l.qz.CLOSE_CHAT_WINDOW,{id:n.id}),g().publish(l.qz.ON_FRESH_DATA,{id:n.id})})).leaveRoom,K=(0,re.r)().markSeenNotifyChat,Q=(0,u.useCallback)((function(e){return{roomName:e.friend.fullName||e.friend.username,roomAvatar:e.friend.avatarUrl,id:e.friend.id}}),[]),X=(0,u.useState)(!0),ne=X[0],ie=X[1],ae=(0,u.useState)(!1),oe=ae[0],le=ae[1],se=(0,u.useState)(!1),ce=se[0],de=se[1],ue=(0,u.useState)(!1),me=ue[0],ve=ue[1],he=(0,u.useState)(!1),pe=he[0],je=he[1];(0,u.useEffect)((function(){var e=g().subscribe(l.qz.ACTION_MENU,(function(e,t){var i=t.id,a=t.action;if(a&&i===n.id)switch(a){case l.kl.EDIT_ROOMNAME:de(!0);break;case l.kl.ADD_MEMBERS:B(n.id),ve(!0);break;case l.kl.LEAVE:(0,h.gH)({message:x("Are you sure to leave this conversation? You will not send or receive messages anymore."),onConfirm:function(){J(i)},overlayProps:{opacity:0}});break;case l.kl.CLEAR_CHAT:D(i),K(i);break;case l.kl.REMOVE_MEMBER:B(n.id),je(!0);break;case l.kl.SHOW_MEMBERS:B(n.id),le(!0)}})),t=g().subscribe(l.qz.MANUAL_UPDATE_CHAT_LIST,(function(e,t){var i=t.id,a=t.action;i&&i===(null===n||void 0===n?void 0:n.id)&&a==l.kl.LEAVE&&I()})),i=g().subscribe(l.qz.CHAT_GPT_LOADING,(function(e,t){Z(t)}));return function(){g().unsubscribe(e),g().unsubscribe(t),g().unsubscribe(i)}}),[null===n||void 0===n?void 0:n.id]);var we=function(){var e=(0,i.Z)((function(){var e,t,i,a,o,l,s;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return null==(t=document.querySelector("#message-item-".concat(null===P||void 0===P||null===(e=P[0])||void 0===e?void 0:e.id," > .message-container")))?[3,3]:t.getAttribute("data-time-stamp")?(ie(!1),[4,T({limit:15,timestamp:null===(i=P[0])||void 0===i?void 0:i.timestamp,chatId:n.id,roomType:n.roomType},j)]):[3,2];case 1:return r.sent(),[3,3];case 2:a=document.querySelector("#chat-window-".concat(n.id," .detail-chat > .chat-nomore-message")),o=document.querySelector("#chat-window-".concat(n.id," .detail-chat")),null==a&&((l=document.createElement("div")).setAttribute("class","chat-nomore-message w-full text-center text-sm mb-2"),s=document.createTextNode(x("No more load")),l.appendChild(s),o.insertBefore(l,o.childNodes[0])),r.label=3;case 3:return[2]}}))}));return function(){return e.apply(this,arguments)}}(),Ee=function(){de(!1)};return(0,o.jsxs)("div",{className:(0,E.Z)(V()["chat-window-item"],{isFullHeight:p}),id:"chat-window-".concat(n.id),children:[(0,o.jsx)("span",{className:"edn-chat-count-new-message",children:(0,o.jsx)("i",{className:"la la-ellipsis-h"})}),(0,o.jsxs)("div",{className:(0,E.Z)("flex items-center justify-between py-2 px-2 relative bg-white",V()["chatbox-header"]),children:[(0,o.jsxs)("div",{className:"".concat(V()["user-acc"]," flex items-center flex-grow"),children:[F?(0,o.jsx)(ge.ZP,{className:"object-cover",src:Q(n).roomAvatar,name:Q(n).roomName,size:"32",round:!0}):(0,o.jsx)(U.Z,{href:"/profile/".concat(Q(n).id),target:"_blank",children:(0,o.jsx)(ge.ZP,{className:"object-cover",src:Q(n).roomAvatar,name:Q(n).roomName,size:"32",round:!0})}),(0,o.jsx)("div",{id:"group-chat-name-".concat(null===n||void 0===n?void 0:n.id),className:"".concat(V()["right-account"]," pl-2 overflow-ellipsis overflow-hidden"),children:F?(0,o.jsx)("span",{className:"whitespace-nowrap text-sm font-semibold",title:Q(n).roomName,children:Q(n).roomName}):(0,o.jsx)(U.Z,{href:"/profile/".concat(Q(n).id),target:"_blank",children:(0,o.jsx)("span",{className:"whitespace-nowrap text-sm font-semibold",title:Q(n).roomName,children:Q(n).roomName})})})]}),(0,o.jsxs)("div",{className:"whitespace-nowrap",children:[(0,o.jsx)(C,{id:n.id,isActive:!0,type:"private",inChatBox:!0,mute:null===n||void 0===n?void 0:n.mute,isOwner:(null===n||void 0===n?void 0:n.ownerId)==(null===_||void 0===_?void 0:_.id)}),(0,o.jsx)(H.z,{onClick:function(){g().publish(l.qz.MINIMIZE_CHAT_WINDOW,{id:n.id})},variant:"subtle",className:"w-8 h-8 rounded-full p-0 text-gray-primary",children:(0,o.jsx)(f.Z,{name:"minus",size:"lg"})}),(0,o.jsx)(H.z,{onClick:function(){O.Z.checkConfirmCloseChatbox(n.id)?(0,h.gH)({htmlContent:(0,o.jsxs)("span",{children:[x("You haven't sent your message. Are you sure you want to close chatbox")," ",(0,o.jsx)("strong",{children:Q(n).roomName})]}),overlayProps:{opacity:0},labelConfirm:x("OK"),onConfirm:function(){I(),g().publish(l.qz.CLOSE_CHAT_WINDOW,{id:n.id})}}):(I(),g().publish(l.qz.CLOSE_CHAT_WINDOW,{id:n.id}))},variant:"subtle",className:"w-8 h-8 rounded-full p-0 text-gray-primary",children:(0,o.jsx)(f.Z,{name:"close",size:"lg"})})]})]}),(0,o.jsxs)("div",{className:(0,E.Z)("container-chatbox flex-grow relative bg-white border-t",{"h-[calc(100%_-_48px)]":w,"h-[calc(100%_-_108px)]":!w}),children:[(0,o.jsx)(v.zv,{visible:oe||pe,children:(0,o.jsx)(be,{roomId:null===n||void 0===n?void 0:n.id,onRemoveMember:function(e,t){(0,h.gH)({htmlContent:(0,o.jsxs)("div",{children:[(0,o.jsxs)("p",{className:"font-bold mb-2",children:[x("Are you sure to remove")," ",t," ",x("from the conversation?")]}),(0,o.jsx)("span",{children:x("The member will able to see the previous messages.")})]}),overlayProps:{opacity:0},onConfirm:function(){$(n.id,e)}})},isEnableRemoveMember:pe,dataRoom:q,onCloseListMembers:function(){le(!1),je(!1)}})}),(0,o.jsx)(v.zv,{visible:ce,children:(0,o.jsx)(A,{onChangeGroupName:function(e){e.match(/^(?!.*<[^>]+>).*/)?e.trim().length>256?te.gU.error(x("Group name must not exceed 256 characters")):Ee():te.gU.error(x("Group name cannot be blank and does not include html."))},roomId:null===n||void 0===n?void 0:n.id,onCloseChangeGroupName:Ee})}),(0,o.jsx)(v.zv,{visible:me,children:(0,o.jsx)(Ne,{open:!0,dataRoom:q,onSubmit:function(e){Y(e,n.id)},roomId:null===n||void 0===n?void 0:n.id,onClose:function(){ve(!1)}})}),(0,o.jsxs)("div",{id:"chatbox-".concat(n.id),className:(0,E.Z)("chatbox flex flex-col relative h-full"),children:[(0,o.jsx)(ee,{isPrivate:!0,roomId:n.id,isActive:!0,messages:P,loadMoreHistory:we,isEnableScroll:ne,currentUserId:null===_||void 0===_?void 0:_.id}),(0,o.jsx)(xe,{roomId:n.id}),(0,o.jsx)(fe,{onReconnect:function(){M()},data:n,isActive:!0,roomId:n.id})]})]})]})},ye=function(e){var t,n,i,a,r=e.data,s=e.isShowMoreItem,d=void 0!==s&&s,u=null===r||void 0===r?void 0:r.id,m=(null===r||void 0===r?void 0:r.notifyCount)>0,v=(0,c.EM)({roomId:u}).closeChanel;return(0,o.jsxs)("div",{className:d?"".concat(V()["bubble-chat-show-more"]):"".concat(V()["bubble-chat-item"]," bg-white relative"),children:[(0,o.jsx)("div",{title:void 0!=(null===r||void 0===r||null===(t=r.friend)||void 0===t?void 0:t.username)?M.DL.escapeForTitleAttribute(null===r||void 0===r||null===(n=r.friend)||void 0===n?void 0:n.username):M.DL.escapeForTitleAttribute(null===r||void 0===r?void 0:r.name),onClick:function(){return function(){var e=(0,x.Z)({},r);g().publish(l.qz.OPEN_CHAT,{data:e})}()},className:"".concat(V()["bubble-chat-item__name"]),children:(0,o.jsx)("span",{children:void 0!=(null===r||void 0===r||null===(i=r.friend)||void 0===i?void 0:i.username)?null===r||void 0===r||null===(a=r.friend)||void 0===a?void 0:a.username:null===r||void 0===r?void 0:r.name})}),(0,o.jsx)("span",{onClick:function(){return e=null===r||void 0===r?void 0:r.id,v(),void g().publish(l.qz.CLOSE_CHAT_WINDOW,{id:e});var e},className:"".concat(V()["bubble-chat-item__btn-close"]," hover:bg-danger hover:text-white"),children:(0,o.jsx)(f.Z,{size:18,name:"close"})}),m&&!d&&(0,o.jsx)("span",{className:"".concat(V()["bubble-chat-item__fleg-mess"]," bg-danger")})]})},Ce=n(29355),Se=function(e){e.showList;var t,n=e.listActiveRoom,i=e.currentUserId,a=(0,Ce.n)(),r=(a.height,a.width,[]);return n.length>0&&n.filter((function(e){return null===e||void 0===e?void 0:e.isMinimize})).length>6?(t=n.length>0&&n.filter((function(e){return null===e||void 0===e?void 0:e.isMinimize})).slice(0,5),r=n.length>0&&n.filter((function(e){return null===e||void 0===e?void 0:e.isMinimize})).slice(5)):t=n.length>0&&n.filter((function(e){return null===e||void 0===e?void 0:e.isMinimize})),(0,o.jsxs)("div",{className:"z-[301] fixed bottom-0 right-0 ".concat(V()["bubble-chat-list"]),children:[t.length>0&&t.map((function(e,t){return(0,o.jsx)(ye,{currentUserId:i,data:e},e.id)})),r.length>0&&(0,o.jsxs)("div",{className:"".concat(V()["show-more-bubble"]," bg-white"),children:[(0,o.jsxs)("span",{className:" font-bold text-sm",children:["+",r.length]}),(0,o.jsx)("div",{className:V()["show-more-wrap"],children:r.map((function(e,t){return(0,o.jsx)(ye,{currentUserId:i,isShowMoreItem:!0,data:e},e.id)}))})]})]})},Ae=n(77063),Ie=function(e){var t=e.isFullHeight,n=(0,L.v9)(Ae.y6),i=(0,L.v9)(Ae.Ns),a=(0,L.v9)(Ae.XD),r=(0,L.v9)(k.tM),l=a.flatMap((function(e){var t=null===n||void 0===n?void 0:n.find((function(t){return t.id===e.id}));return t?(0,D.Z)((0,x.Z)({},t),{isMinimize:e.isMinimize,lastActiveTime:e.lastActiveTime}):e}));return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Se,{currentUserId:null===r||void 0===r?void 0:r.id,listActiveRoom:l,showList:i}),l.length>0&&(0,o.jsx)("div",{className:"".concat(V()["list-chat-room"]," z-[201] fixed bottom-0 right-0 flex flex-row-reverse"),style:{marginRight:l.filter((function(e){return null===e||void 0===e?void 0:e.isMinimize})).length>0?"4rem":"0"},children:l.filter((function(e){return!e.isMinimize})).map((function(e){return(0,o.jsx)(Ee,{isFullHeight:t,data:e},e.id)}))})]})}},79290:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var i=n(84644),a={encodeSingleQuote:function(e){return null===e||void 0===e?void 0:e.replaceAll("'","&apos;")},decodeQuote:function(e){return null===e||void 0===e?void 0:e.replaceAll("&quot;",'"')},MessageData:function(e,t,n,a,r){var o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],l=arguments.length>6?arguments[6]:void 0,s={id:"",clientKey:"",message:""},c={replyMessageId:"",type:"",data:"",tagList:[],privateChat:!0},d={text:"",url:[],type:"",replyObject:null};return"DELETE_MESSAGE"!=t&&"REACTION"!=t?(d.text=i.DL.htmlEncode(n),d.url=a,d.type=""!=a?"ATTACHMENT":"MESSAGE",d.replyObject=r,null!=r&&(c.replyMessageId=JSON.parse(r).id)):d=n,c.privateChat=o,c.type=t,c.data=d,c.tagList=null,s.id=e,s.clientKey=l+"-"+(new Date).toISOString(),s.message=c,s},Linkify:function(e){if(null===e||void 0===e)return"";var t,n,i,a;if(n=/(\b(https?|ftp|file):\/\/[-A-Z\xc4\xd6\xc50-9+&@#\/%?=~_|!:,.;]*[-A-Z\xc4\xd6\xc50-9+&@#\/%=~_|])/gim,i=/(^|[^\/f])(www\.[-A-Z\xc4\xd6\xc50-9+&@#\/%?=~_|!:,.;]*[-A-Z\xc4\xd6\xc50-9+&@#\/%=~_|])/gim,a=/(([A-Z\xc4\xd6\xc50-9\-\_\.])+@[A-Z\xc4\xd6\xc5\_]+?(\.[A-Z\xc4\xd6\xc5]{2,6})+)/gim,t=(t=(t=e.replace(n,(function(e,t){try{var n=new URL(t);return/^[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(n.hostname)?e:'<a href="'+e+'" target="_blank">'+e+"</a>"}catch(i){return e}}))).replace(i,'$1<a href="https://$2" target="_blank">$2</a>')).replace(a,'<a href="mailto:$1" target="_blank">$1</a>'),(e.match(/<a href/g)||[]).length>0){for(var r=e.split(/(<\/a>)/g),o=0;o<r.length;o++)null==r[o].match(/<a href/g)&&(r[o]=r[o].replace(n,'<a href="$1" target="_blank">$1</a>').replace(i,'$1<a href="https://$2" target="_blank">$2</a>').replace(a,'<a href="mailto:$1" target="_blank">$1</a>'));return r.join("")}return t},checkConfirmCloseChatbox:function(e){var t=!1,n=document.getElementById("txt-smg-".concat(e));null!=n&&(n.value.trim().length>0&&(t=!0));var i=document.getElementById("list-file-upload-".concat(e));null!=i&&i.hasChildNodes()&&(t=!0);var a=document.getElementsByClassName("isEditting-message-".concat(e));return null!=a&&a.length>0&&(t=!0),t},hasContentIsTyping:function(e){var t=!1,n=document.getElementById("txt-smg-".concat(e));null!=n&&(n.value.trim().length>0&&(t=!0));var i=document.getElementById("list-file-upload-".concat(e));return null!=i&&i.hasChildNodes()&&(t=!0),t}}},25228:function(e,t,n){"use strict";n.d(t,{EM:function(){return T},Qi:function(){return D},RT:function(){return C},bG:function(){return A}});var i=n(47568),a=n(26042),r=n(29815),o=n(70655),l=n(44104),s=n(49925),c=n(23880),d=n(78052),u=n(1798),m=n.n(u),v=n(67294),h=n(28e3),f=n.n(h),p=n(42121),g=n(89486),b=n(97892),x=n(48929),_=n(9473),j=n(97274),w=n(21876).Buffer,N=!1,E=null,y=0,C=function(e){var t=(0,a.Z)({},e),n=t.onConnected,i=t.onError,r=(0,_.v9)(x.tM),o=(0,_.v9)(x.rK),c=(0,v.useState)(y),u=c[0],h=c[1],C=(0,v.useState)(void 0),A=C[0],I=C[1],T=(0,g.Z)().postMessage,M=((0,_.oR)(),j.XK),D=(M>r.id?"".concat(r.id,"_").concat(M):"".concat(M,"_").concat(r.id),j.qY>r.id?"".concat(r.id,"_").concat(j.qY):"".concat(j.qY,"_").concat(r.id)),O=function(){!function(e,t){var n=s.S.CHAT_NOTIFY_CHAT+t;S(n,(function(t){e(t)}),"user-"+t)}((function(e){var t,n,i=JSON.parse(e.body);y=i.total;var a=i.roomId,o=i.senderId,s=i.messageType;h(i.total),I(i),T(b.J["EDV.API.Chat.count"],i.total);var c,d=(0,p.I)();((null===i||void 0===i||null===(t=i.message)||void 0===t?void 0:t.roomId)&&s===l.YN.USER_SEEN_MESSAGE&&m().publish(l.qz.ON_NEW_NOTIFY,i),(o==j.qY||(null===i||void 0===i||null===(n=i.message)||void 0===n?void 0:n.roomId)===D&&s===l.YN.USER_SEEN_MESSAGE)&&T(b.J["EDV.API.ChatGPT.count"],i.total),a&&o!=(null===r||void 0===r?void 0:r.id))&&([l.YN.SYSTEM_MESSAGE,l.YN.TEXT].includes(s)&&(null===i||void 0===i||null===(c=i.message)||void 0===c?void 0:c.type)!==l.hD.USERS_REMOVED&&m().publish(l.qz.ON_NEW_NOTIFY,i));if(void 0!=a){if(void 0!==s&&s===l.YN.SYSTEM_MESSAGE){var u=i.message;(null===u||void 0===u?void 0:u.type)==l.hD.PRIVATE_CHAT_STARTED&&m().publish(l.hD.PRIVATE_CHAT_STARTED,{id:a})}if(d&&-1!==d.findIndex((function(e){return(null===e||void 0===e?void 0:e.id)===a}))&&void 0!==s&&s===l.YN.SYSTEM_MESSAGE){var v=i.message,f=null===v||void 0===v?void 0:v.type;f==l.hD.ROOM_NAME_UPDATED&&m().publish(l.qz.MANUAL_UPDATE_CHAT_LIST,{id:a,name:v.message.newName,action:l.kl.EDIT_ROOMNAME}),(f==l.hD.USERS_LEFT_ROOM&&o==(null===r||void 0===r?void 0:r.id)||f==l.hD.USERS_REMOVED&&(null===r||void 0===r?void 0:r.id)==v.message.members[0].id)&&(m().publish(l.qz.MANUAL_UPDATE_CHAT_LIST,{id:a,action:l.kl.REMOVE_MEMBER}),f==l.hD.USERS_LEFT_ROOM&&o==(null===r||void 0===r?void 0:r.id)&&m().publish(l.qz.MANUAL_UPDATE_CHAT_LIST,{id:a,action:l.kl.LEAVE}));var g=f==l.hD.USERS_ADDED&&v.message.members[0].id==(null===r||void 0===r?void 0:r.id);f==l.hD.USERS_ADDED&&v.message.members[0].id==(null===r||void 0===r?void 0:r.id)&&m().publish(l.qz.UPDATE_CHAT_ROOM_LIST_WHEN_USER_ADD,a),g&&(m().publish(l.qz.USER_ADD,{room_Id:a}),m().publish(l.qz.MANUAL_UPDATE_CHAT_LIST,{id:a,action:l.kl.ADD_MEMBERS}))}}}),null===r||void 0===r?void 0:r.id),n&&n(E)},R=function(e){i&&i(e)},k=function(e){try{var t=new(f())(s.t.CHAT_SOCKET_CONNECTION+w.from(e).toString("base64"),null,{transports:"websocket"});return t.onerror=function(){t.close()},t.onclose=function(t){console.error("Server Err:"+JSON.stringify(t)),console.info("Connect retry:"+(new Date).toLocaleString()),setTimeout((function(){var t;N&&(null===E||void 0===E||null===(t=E.disconnect)||void 0===t||t.call(E),N=!1);k(e)}),2e3)},t}catch(n){return console.log("createSockConnect error",n),null}};return(0,v.useEffect)((function(){if(o){var e;try{(e=k(o))&&null===E&&((E=d.L.over(e)).connect({},O,R),E.debug=function(){})}catch(t){}return function(){try{var n;E=null,null===e||void 0===e||null===(n=e.close)||void 0===n||n.call(e)}catch(t){}}}}),[o]),{count:u,countValue:u>9?"9+":u,message:A}},S=function(e,t,n){try{var i;if(E)null===(i=E.subscribe)||void 0===i||i.call(E,e,t,{id:n})}catch(a){console.log("err openSubcrible",a)}},A=function(e,t){var n;E&&(null===(n=E.send)||void 0===n||n.call(E,"/chat/message/"+e,{},JSON.stringify(t)))},I=new Set,T=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"vi",n=(0,a.Z)({},e).roomId,l=!0,d="private",u=(0,v.useState)(void 0),m=u[0],h=u[1],f=(0,v.useState)(void 0),p=f[0],g=f[1];(0,v.useEffect)((function(){var i=p||[];if(l){var a=("private"===d?s.S.CHAT_SUB_PRIVATE:s.S.CHAT_SUB_GROUP)+n;S(a,(function(t){I.has(n)||I.add(n);var a=JSON.parse(t.body);"undefined"!=typeof a.messages||"[object Array]"===Object.prototype.toString.call(a)?(i=a.messages,h(a.messages)):"USER_SEEN_MESSAGE"!=t.type&&(i=b(i,a),h(i)),(null===e||void 0===e?void 0:e.afterGetMessage)&&e.afterGetMessage()}),n)}else w({limit:15,timestamp:null,chatId:n},t);return function(){if(I.delete(n),E)try{var e;null===E||void 0===E||null===(e=E.unsubscribe)||void 0===e||e.call(E,n)}catch(t){}}}),[n]),(0,v.useEffect)((function(){h(p)}),[p]);var b=function(e,t){var i=document.querySelector("#chat-window-".concat(n," .detail-chat > .chat-nomore-message"));return null!=i&&i.parentNode.removeChild(i),e&&e.length>0&&e.filter((function(e){return(null===e||void 0===e?void 0:e.id)===(null===t||void 0===t?void 0:t.id)})).length>0&&(e=e.filter((function(e){return(null===e||void 0===e?void 0:e.id)!==(null===t||void 0===t?void 0:t.id)}))),e&&e.length>0?(0,r.Z)(e).concat((0,r.Z)([t])):[t]},x=function(){if(null===I||void 0===I||I.delete(n),E)try{var e;null===E||void 0===E||null===(e=E.unsubscribe)||void 0===e||e.call(E,n)}catch(t){}},_=function(e){g(m?(0,r.Z)(e).concat((0,r.Z)(m)):e)},j=function(){var t=p||[],i=("private"===d?s.S.CHAT_SUB_PRIVATE:s.S.CHAT_SUB_GROUP)+n;S(i,(function(i){I.has(n)||I.add(n);var a=JSON.parse(i.body);"undefined"!=typeof a.messages||"[object Array]"===Object.prototype.toString.call(a)?(t=a.messages,h(a.messages)):"USER_SEEN_MESSAGE"!=i.type&&(t=b(t,a),h(t)),(null===e||void 0===e?void 0:e.afterGetMessage)&&e.afterGetMessage()}),n)},w=function(){var e=(0,i.Z)((function(e){var t,n=arguments;return(0,o.__generator)(this,(function(i){switch(i.label){case 0:return t=n.length>1&&void 0!==n[1]?n[1]:"en",[4,c.a.getChatHistoryPrivate({limit:e.limit,timestamp:e.timestamp,chatId:e.chatId}).then((function(n){var i,a;(null===n||void 0===n||null===(i=n.data)||void 0===i?void 0:i.messages.length)>0?(_(null===n||void 0===n||null===(a=n.data)||void 0===a?void 0:a.messages),N(e.chatId)):M(e,t)})).catch((function(){}))];case 1:return i.sent(),[2]}}))}));return function(t){return e.apply(this,arguments)}}(),N=function(e){var t=document.getElementById("detail-chat-".concat(e));null!=t&&t.scrollBy(0,10)};return{messages:m,closeChanel:x,addHistories:_,loadMoreMessage:w,reConnect:j}},M=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"vi",n=document.querySelector("#chat-window-".concat(e.chatId," .detail-chat > .chat-nomore-message")),i=document.querySelector("#chat-window-".concat(e.chatId," .detail-chat"));if(null==n){var a=document.createElement("div");a.setAttribute("class","chat-nomore-message w-full text-center text-sm mb-2");var r="No more load";"vi"==t?r="Kh\xf4ng c\xf2n tin nh\u1eafn":"jp"==t&&(r="\u65b0\u3057\u3044\u30e1\u30c3\u30bb\u30fc\u30b8\u306f\u3042\u308a\u307e\u305b\u3093");var o=document.createTextNode(r);a.appendChild(o),i.insertBefore(a,i.childNodes[0])}},D=function(e){}},96906:function(e,t,n){"use strict";n.d(t,{N:function(){return c}});var i=n(47568),a=n(70655),r=n(23880),o=n(44104),l=n(1798),s=n.n(l),c=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=function(){var t=(0,i.Z)((function(t){return(0,a.__generator)(this,(function(n){switch(n.label){case 0:return[4,r.a.clearHistories(t).then((function(n){s().publish(o.qz.CLOSE_CHAT_WINDOW,{id:t}),s().publish(o.qz.ON_FRESH_DATA,{id:t}),null!=e&&e(t)})).catch((function(n){null!=e&&e(t)}))];case 1:return n.sent(),[2]}}))}));return function(e){return t.apply(this,arguments)}}();return{clearHistories:t}}},42121:function(e,t,n){"use strict";n.d(t,{I:function(){return m},z:function(){return u}});var i=n(47568),a=n(70655),r=n(44104),o=n(23880),l=n(67294),s=n(9473),c=n(77063),d=[],u=function(){var e=(0,s.I0)(),t=(0,s.v9)(c.y6);d=t;return{data:t,refetch:(0,l.useCallback)((0,i.Z)((function(){var t,n,i;return(0,a.__generator)(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,3,4]),[4,o.a.getChatRoomsV2({limit:50,offset:0,progress:!1})];case 1:return n=a.sent(),(null===(t=n.data)||void 0===t?void 0:t.data)?(d=null===(i=n.data)||void 0===i?void 0:i.data,e((0,c.X2)(d))):(d=[],e((0,c.X2)(d))),[3,4];case 2:return a.sent(),d=[],e((0,c.X2)(d)),[3,4];case 3:return e((0,c.SN)(!0)),[7];case 4:return[2]}}))})),[]),manualUpdateChatList:function(t){if(d&&d.length>0){var n=d.findIndex((function(e){return e.id===t.id}));switch(t.action){case r.kl.EDIT_ROOMNAME:d[n].name=t.name;break;case r.kl.LEAVE:case r.kl.REMOVE_MEMBER:n>-1&&(d[n].active=!1);break;case r.kl.ADD_MEMBERS:n>-1&&(d[n].active=!0)}e((0,c.X2)(d))}}}},m=function(){return d}},44138:function(e,t,n){"use strict";n.d(t,{S:function(){return c}});var i=n(47568),a=n(70655),r=n(23880),o=n(44104),l=n(1798),s=n.n(l),c=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=function(){var t=(0,i.Z)((function(t){return(0,a.__generator)(this,(function(n){switch(n.label){case 0:return[4,r.a.leaveRoom(t).then((function(n){s().publish(o.qz.CLOSE_CHAT_WINDOW,{id:t}),s().publish(o.qz.ON_FRESH_DATA,{id:t}),n&&null!=e&&e(t)})).catch((function(){console.log("Leave room failed")}))];case 1:return n.sent(),[2]}}))}));return function(e){return t.apply(this,arguments)}}();return{leaveRoom:t}}},33721:function(e,t,n){"use strict";n.d(t,{r:function(){return c}});var i=n(47568),a=n(70655),r=n(23880),o=n(44104),l=n(1798),s=n.n(l),c=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=function(){var t=(0,i.Z)((function(t){return(0,a.__generator)(this,(function(n){switch(n.label){case 0:return[4,r.a.seenNotifyChat(t).then((function(){s().publish(o.qz.ON_FRESH_DATA,{data:{id:t}}),null!=e&&e()})).catch((function(){console.log("Mark seen notify failed")}))];case 1:return n.sent(),[2]}}))}));return function(e){return t.apply(this,arguments)}}();return{markSeenNotifyChat:t}}},82859:function(e,t,n){"use strict";n.d(t,{Q:function(){return r}});var i=n(85893),a=(n(67294),n(96486)),r=function(e){var t=e.line,n=void 0===t?1:t,r=e.className,o=e.children,l=(0,a.isString)(o)?o:null;return(0,i.jsx)("span",{className:r,style:{display:"-webkit-box",WebkitLineClamp:n,WebkitBoxOrient:"vertical",overflow:"hidden",wordBreak:"break-word"},title:l,children:o})}},67887:function(e){e.exports={root:"RawText_root__4tSYq",h1:"RawText_h1__RBu8N",h2:"RawText_h2__JXomP",h3:"RawText_h3__renle",h4:"RawText_h4__xw8a0",h5:"RawText_h5__VlpG_","table-border":"RawText_table-border__D5twh",table:"RawText_table__coGOa","none-list":"RawText_none-list__NFxK5"}},30642:function(e){e.exports={"wrap-chat-item":"ChatItem_wrap-chat-item__a1Aue","wrap-chat-info":"ChatItem_wrap-chat-info__ASD5D","message-item-menu":"ChatItem_message-item-menu__bmnqB","current-user":"ChatItem_current-user__mMOIe","sub-menu":"ChatItem_sub-menu__sInmu","wrap-detail-message":"ChatItem_wrap-detail-message__Pqa_f","submenu-wrap":"ChatItem_submenu-wrap__MdAnw","submenu-content":"ChatItem_submenu-content__7AF0A","content-reply":"ChatItem_content-reply__f2s5f","reply-author":"ChatItem_reply-author__d6V8D","message-text":"ChatItem_message-text__Dgr0q","has-notice":"ChatItem_has-notice__SCORC"}},62097:function(e){e.exports={"user-acc":"ChatWindow_user-acc__wmk5w","right-account":"ChatWindow_right-account__Kfgtz","member-item":"ChatWindow_member-item__VKCkb","btn-remove-member":"ChatWindow_btn-remove-member__eZohT","list-chat-wrap":"ChatWindow_list-chat-wrap__J658e","list-chat-active":"ChatWindow_list-chat-active__kIBN_","list-chat-room":"ChatWindow_list-chat-room__jE96X","bubble-chat-list":"ChatWindow_bubble-chat-list__xj_nb","chat-window-item":"ChatWindow_chat-window-item__MjTBd","chatbox-header":"ChatWindow_chatbox-header__mKRvE","bubble-chat-item":"ChatWindow_bubble-chat-item__oAemP","bubble-chat-item__name":"ChatWindow_bubble-chat-item__name__gz_jj","bubble-chat-item__btn-close":"ChatWindow_bubble-chat-item__btn-close__oCwdg","bubble-chat-item__fleg-mess":"ChatWindow_bubble-chat-item__fleg-mess__vUSPJ","show-more-bubble":"ChatWindow_show-more-bubble__B0pvQ","show-more-wrap":"ChatWindow_show-more-wrap__80CEG","bubble-chat-show-more":"ChatWindow_bubble-chat-show-more__fO9RE","mes-user-name":"ChatWindow_mes-user-name__A5Xjn"}},98150:function(e){e.exports={formSendChat:"FormSendChat_formSendChat__3WlLa"}}}]);